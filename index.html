<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>QR RAČUNATOR</title>
  <meta name="google-site-verification" content="MiNsi-1k4TYmSbTNGPDs_lsgTyiVKmxEa4nkihpTB1s" />
  <meta property="og:title" content="QR RAČUNATOR" />
  <meta property="og:description" content="Web aplikacija za skeniranje QR kodova s Hrvatskih fiskalnih računa i automatsko zbrajanje iznosa. Uključuje povijest i pretragu."/>
  <meta name="description" content="Web aplikacija za skeniranje QR kodova s Hrvatskih fiskalnih računa i automatsko zbrajanje iznosa. Uključuje povijest i pretragu.">
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://soboslikar.github.io/QR-RACUNATOR/" />
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    /* --- OSNOVNI STILOVI --- */
    body { font-family: sans-serif; margin: 0; padding: 0.5em; background: #f4f4f4; overflow-x: hidden; min-height: 100vh; }
    body.scanner-view #history-page, body.scanner-view #ads-page { display: none; }
    body.history-view { background-color: white; }
    body.ads-view { background-color: #00008B; }

    body.history-view #history-page, body.ads-view #ads-page {
        display: flex;
        flex-direction: column;
        padding: 0;
        min-height: calc(100vh - 1em);
        max-height: calc(100vh - 1em);
        box-sizing: border-box;
        overflow: hidden;
    }

    body.history-view .scanner-ui, body.ads-view .scanner-ui { display: none !important; }

    /* --- SKENER UI --- */
    #header { text-align: center; color: yellow; font-size: 1.2em; font-weight: bold; margin-bottom: 0.5em; position: absolute; width: 100%; left: 0; top: 1em; z-index: 3; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7); }
    #scan-instruction { position: absolute; top: 2.8em; left: 50%; transform: translateX(-50%); width: 90%; text-align: center; color: white; font-size: 1em; font-weight: bold; z-index: 2; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8); pointer-events: none; display: block; }
    #reader { width: 100%; max-width: 400px; margin: auto; height: 55vh; position: relative; border: 1px solid #ccc; background: #e0e0e0; }
    #total-container { position: fixed; top: 23.5em; left: 50%; transform: translateX(-50%); z-index: 6; display: flex; align-items: center; gap: 10px; background-color: rgba(0, 0, 0, 0.5); padding: 0.2em 0.5em; border-radius: 5px; }
    #total { font-size: 1.6em !important; font-weight: bold; color: yellow; text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
    #ads-button { background-color: #1e7e34; color: white; font-weight: bold; font-size: 1.2em; padding: 0.6em 1.2em; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3); text-shadow: 1px 1px 2px rgba(0,0,0,0.4); animation: pulse-ads 1.5s ease-in-out infinite; display: none; white-space: nowrap; }
    #ads-button:active { box-shadow: inset 0 2px 4px rgba(0,0,0,0.4); animation: none; }
    @keyframes pulse-ads { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    #ocisti-button { padding: 0; width: 120px; height: 60px; font-size: 0.9em; font-weight: bold; background: #ff0000; color: yellow; display: none; line-height: 1.3; text-align: center; border-radius: 5px; margin-left: 20px; }
    #ocisti-button.confirm-mode { background-color: yellow; color: black; }
    #session-name-container { position: fixed; top: 27.5em; left: 50%; transform: translateX(-50%); z-index: 5; display: flex; align-items: center; width: 95%; max-width: 400px; justify-content: space-between; min-height: 35px; text-align: center; margin-top: 10px; background-color: rgba(0, 0, 0, 0.5); padding: 0.2em 0.5em; border-radius: 5px; gap: 15px; }
    #session-name-wrapper { display: flex; align-items: center; gap: 8px; flex-shrink: 1; min-width: 0; flex-grow: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-left: 5px; }
    #add-name-btn { padding: 0.4em 0.8em; font-size: 0.9em; background-color: #e0e0e0; color: black; display: block; flex-shrink: 0; font-weight: bold; white-space: nowrap; }
    #session-name-input { font-size: 1.2em; padding: 0.3em 0.5em; border: 1px solid #ccc; border-radius: 4px; width: 100%; display: none; box-sizing: border-box; flex-grow: 1; }
    #session-name-display { font-size: 1em; font-weight: bold; color: yellow; background-color: rgba(0, 0, 0, 0.5); padding: 0.3em 0.8em; border-radius: 5px; display: none; align-items: center; gap: 8px; flex-grow: 1; min-width: 50px; text-align: left; box-sizing: border-box; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    #session-name-display .edit-icon { cursor: pointer; font-size: 0.8em; font-weight: normal; color: white; text-decoration: underline; flex-shrink: 0; }
    #manual-entry-btn { background-color: orange; color: black; padding: 0.4em 0.8em; font-size: 0.9em; font-weight: bold; border: none; border-radius: 5px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); text-align: center; line-height: 1.3; flex-shrink: 0; min-width: 90px; white-space: nowrap; margin-right: 5px; }
    #invoice-count { font-size: 1.4em; color: black; padding: 0.1em 0.4em; position: fixed; bottom: 170px; right: 50px; z-index: 2; text-align: right; font-weight: bold; }
    #duplicate-warning, #loaded-message, #delete-warning { position: fixed; left: 50%; transform: translateX(-50%); z-index: 10; display: none; font-weight: bold; text-align: center; padding: 0.8em 2em; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,4,8,0.2); }
    #loaded-message { color: green; top: 30%; background-color: rgba(255, 255, 255, 0.85); animation: zoomFade 1s ease-out; }
    #duplicate-warning { color: red; top: 12.8em; background-color: rgba(255, 255, 255, 0.8); border: 1px solid red; }
    #delete-warning { top: 21.5em; padding: 0.3em 0.6em; white-space: nowrap; }
    #delete-warning.delete-mode { color: black; background-color: rgba(255, 255, 0, 0.8); }
    #delete-warning.info-mode { color: white; background-color: rgba(0, 0, 0, 0.6); }
    #history { max-height: 180px; overflow-y: auto; margin: 0; padding: 1em; background: white; border-radius: 5px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); width: 150px; position: fixed; bottom: 10px; left: 10px; z-index: 1; display: block; }
    #history ul { list-style: none; padding: 0; margin: 0; }
    #history li { padding: 0.5em 0; border-bottom: 1px solid #eee; white-space: pre; font-weight: bold; overflow: hidden; text-overflow: ellipsis; font-size: 1em; }
    button { padding: 0.5em 1em; font-size: 1em; border: none; border-radius: 5px; color: black; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    button:active { box-shadow: inset 0 1px 2px rgba(0,0,0,0.3); }
    .red-btn { background: #ff0000; color: yellow; }
    #remove-from-list-btn { position: fixed; bottom: 130px; right: 50px; z-index: 3; }
    #history-toggle-btn { position: fixed; bottom: 80px; right: 50px; z-index: 3; background-color: white; color: blue; font-weight: bold; }
    #share-button { position: fixed; bottom: 30px; right: 15px; z-index: 3; background-color: green; color: white; animation: pulse-share 1.5s ease-in-out infinite; }
    #running-text-container { position: absolute; top: 4.8em; left: 0; width: 100%; overflow: hidden; white-space: nowrap; z-index: 2; pointer-events: none; display: none; }
    #running-text-container span { display: inline-block; padding-left: 100%; font-size: 1.4em; font-weight: bold; color: yellow; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8); animation: marquee 25s linear infinite; white-space: pre; }
    #share-prompt-overlay { position: absolute; top: 7em; left: 50%; transform: translateX(-50%); width: 60%; background-color: rgba(0, 0, 0, 0.75); color: lightgreen; font-size: 1.3em; font-weight: bold; text-align: center; padding: 1.5em 1em; border-radius: 10px; z-index: 4; display: none; line-height: 1.4; }
    #counter-deactivated-indicator { position: fixed; top: 10px; left: 10px; font-size: 1em; color: limegreen; z-index: 5; display: none; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
    #switch-camera-btn { position: fixed; top: 10px; right: 10px; z-index: 5; padding: 6px 8px; background-color: #007bff; color: white; border-radius: 50%; font-size: 1.4em; line-height: 1; }
    #camera-selection-overlay { position: fixed; top: 55px; right: 10px; background-color: white; border: 1px solid #ccc; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 6; padding: 5px 0; display: none; max-height: 150px; overflow-y: auto; min-width: 150px; }
    #camera-list { list-style: none; padding: 0; margin: 0; }
    #camera-list li { padding: 8px 12px; cursor: pointer; font-size: 0.9em; }
    #camera-list li:hover { background-color: #f0f0f0; }
    #manual-entry-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 100; display: none; justify-content: center; align-items: center; }
    #manual-entry-modal-content { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); max-width: 90%; width: 300px; text-align: center; }
    #import-file-input { display: none; }

    /* --- STICKY HEADER (History & Ads) --- */
    #history-sticky-header, #ads-sticky-header { position: sticky; top: 0; z-index: 10; padding: 0.5em 1em; border-bottom: 1px solid #ccc; flex-shrink: 0; }
    #history-sticky-header { background-color: white; }
    #ads-sticky-header { background-color: #f9f9f9; }
    #history-header, #ads-header { display: flex; align-items: center; justify-content: space-between; }
    #history-header h1, #ads-header h1 { margin: 0; text-align: center; flex-grow: 1; font-size: 1.3em; }
    #back-to-scanner-btn, #back-to-scanner-from-ads-btn { background-color: green; color: white; border: none; font-weight: bold; margin: 0; padding: 0.4em 0.8em; font-size: 0.9em; cursor: pointer; }
    
    /* --- SADRŽAJ (History & Ads) --- */
    #history-content, #ads-content { flex-grow: 1; overflow-y: auto; padding: 1em; position: relative; }

    /* --- STILOVI ZA OGLASE --- */
    .ad-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .ad-title { font-size: 1.2em; font-weight: bold; text-align: center; margin-bottom: 10px; }
    .ad-contact, .ad-web-link { text-align: center; margin-top: 15px; }
    .ad-contact a, .ad-web-link a { font-weight: bold; font-size: 1.1em; color: #007bff; text-decoration: none; }
    .ad-contact a:hover, .ad-web-link a:hover { text-decoration: underline; }
    .ad-text { font-size: 1em; margin-top: 15px; line-height: 1.4; }
    #ads-footer-promo { text-align: center; margin-top: 20px; padding: 15px; font-size: 1.1em; font-weight: bold; color: #333; background-color: #f0f0f0; border-radius: 5px; }
    
    /* --- NOVO: GALERIJA/SLIDER --- */
    .media-slider-container { position: relative; overflow: hidden; margin-bottom: 10px; }
    .media-slide { display: none; }
    .media-slide.active { display: block; }
    .media-slide img { width: 100%; height: auto; display: block; cursor: pointer; border-radius: 5px; }
    .media-slide iframe { width: 100%; height: auto; min-height: 200px; border: none; border-radius: 5px; }
    .slider-arrow { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(0, 0, 0, 0.5); color: white; border: none; font-size: 1.5em; padding: 0.3em 0.6em; cursor: pointer; z-index: 1; border-radius: 50%; }
    .slider-arrow.prev-arrow { left: 10px; }
    .slider-arrow.next-arrow { right: 10px; }

    /* --- NOVO: LIGHTBOX ZA SLIKE --- */
    #lightbox-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); z-index: 200; display: none; justify-content: center; align-items: center; }
    #lightbox-content { position: relative; max-width: 95%; max-height: 95%; }
    #lightbox-image { max-width: 100%; max-height: 100%; object-fit: contain; }
    #close-lightbox { position: absolute; top: -35px; right: 0; color: white; font-size: 2.5em; font-weight: bold; cursor: pointer; }

    /* --- OSTALI STILOVI --- */
    @keyframes zoomFade { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } 50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 0; } }
    @keyframes pulse-share { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }
    @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
  </style>
</head>
<body class="scanner-view">

  <!-- Svi UI elementi skenera su grupirani radi lakšeg sakrivanja -->
  <div class="scanner-ui" id="header">QR Skener-Kalkulator</div>
  <div class="scanner-ui" id="scan-instruction">Pozicioniraj qr kod unutar kvadrata kamere</div>
  <div class="scanner-ui" id="running-text-container" style="display: none;"><span></span></div>
  <div class="scanner-ui" id="share-prompt-overlay" style="display: none;">KLIKNI ZELENI GUMB<br>I PODIJELI RAČUNATOR<br>PORUKA ĆE NESTATI</div>
  <div class="scanner-ui" id="reader"></div>
  <div class="scanner-ui" id="switch-camera-btn" style="display: none;">🔄</div>
  <div class="scanner-ui" id="camera-selection-overlay" style="display: none;"><ul id="camera-list"></ul></div>
  <div class="scanner-ui" id="loaded-message" style="display: none;">UČITANO</div>
  <div class="scanner-ui" id="duplicate-warning" style="display: none;">TAJ RAČUN JE URAČUNAT</div>
  <div class="scanner-ui" id="total-container">
      <div id="total">UKUPNO: 0.00 €</div>
      <button id="ads-button" style="display: none;"></button>
      <button id="ocisti-button" onclick="startOcistiConfirm()" style="display: none;">SPREMI<br>I OČISTI</button>
  </div>
  <div class="scanner-ui" id="session-name-container">
      <div id="session-name-wrapper">
          <button id="add-name-btn" onclick="startAddName()">DODAJ NAZIV</button>
          <input type="text" id="session-name-input" placeholder="Unesi naziv sesije..." maxlength="30">
          <span id="session-name-display">
              <span id="session-name-text"></span>
              <span class="edit-icon" onclick="startAddName()">Uredi</span>
          </span>
      </div>
      <button id="manual-entry-btn">SAM UPIŠI RAČ:</button>
  </div>
  <div class="scanner-ui" id="invoice-count">0 RAČUNA</div>
  <div class="scanner-ui" id="history" style="display: none;"> <ul id="historyList"></ul> </div>
  <button class="scanner-ui" id="remove-from-list-btn" onclick="startRemoveFromList()" style="display:none;">Obriši iz liste</button>
  <button class="scanner-ui" id="history-toggle-btn">POVIJEST</button>
  <button class="scanner-ui" id="share-button" style="display: none;">DIJELI RAČUNATOR</button>
  <div class="scanner-ui" id="delete-warning" style="display: none;"></div>
  <div class="scanner-ui" id="counter-deactivated-indicator" style="display: none;">✔</div>
  <div class="scanner-ui" id="manual-entry-modal-overlay" style="display: none;">
      <div id="manual-entry-modal-content">
          <h3 style="margin-top: 0; color: #333;">Ručni unos računa</h3>
          <div><label for="manual-amount-input">Iznos (€):</label><input type="text" id="manual-amount-input" placeholder="npr. 15,99 ili 25.00"></div>
          <div><label for="manual-time-input">Vrijeme (HH:MM - opcionalno):</label><input type="text" id="manual-time-input" placeholder="npr. 14:35" pattern="^([0-1]?\d|2[0-3]):([0-5]?\d)$"></div>
          <div style="display: flex; justify-content: space-around; gap: 10px;"><button id="manual-add-btn">Dodaj račun</button><button id="manual-cancel-btn">Odustani</button></div>
          <p id="manual-entry-error" style="color: red; font-size: 0.9em; margin-top: 10px; display: none;"></p>
      </div>
  </div>

  <!-- STRANICA ZA POVIJEST -->
  <div id="history-page">
      <div id="history-sticky-header">
          <div id="history-header"> <button id="back-to-scanner-btn">< NA SKENER</button> <h1>POVIJEST</h1> </div>
          <div id="history-dynamic-header-content"></div>
      </div>
      <div id="history-content"></div>
  </div>

  <!-- STRANICA ZA OGLASE -->
  <div id="ads-page">
      <div id="ads-sticky-header">
          <div id="ads-header">
              <button id="back-to-scanner-from-ads-btn">< NA SKENER</button>
              <h1>PONUDE</h1>
          </div>
      </div>
      <div id="ads-content"></div>
  </div>

  <!-- NOVI LIGHTBOX ELEMENT -->
  <div id="lightbox-overlay">
      <span id="close-lightbox">&times;</span>
      <div id="lightbox-content">
          <img src="" id="lightbox-image" alt="Povećana slika">
      </div>
  </div>

  <input type="file" id="import-file-input" accept=".json">

  <audio id="scan-sound" src="https://raw.githubusercontent.com/Soboslikar/QR-RACUNATOR/main/novo2.mp3" preload="auto"></audio>
  <audio id="click-sound" src="https://raw.githubusercontent.com/Soboslikar/QR-RACUNATOR/main/click8.mp3" preload="auto"></audio>
  <audio id="remove-sound" src="https://raw.githubusercontent.com/Soboslikar/QR-RACUNATOR/main/smeče.mp3" preload="auto"></audio>
  <audio id="error-sound" src="https://raw.githubusercontent.com/Soboslikar/QR-RACUNATOR/main/error.mp3" preload="auto"></audio>
  <audio id="clear-session-sound" src="https://raw.githubusercontent.com/Soboslikar/QR-RACUNATOR/main/Čiščenje.mp3" preload="auto"></audio>

<script>
    // Ovdje ide kompletan JavaScript kod.
    // Zbog ograničenja duljine, ovdje je prikazana samo struktura.
    // U stvarnoj datoteci, ovdje zalijepite kompletan JavaScript kod.
    // *** GLOBALNE VARIJABLE I KONSTANTE ***
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwCM5SreGB0O-YjGW_xzyxtiYeV9fhn0jyN5vFEYjfBBd5IAj5E96SF2Jh2bGMMqcnA/exec';
    // ... (ostale konstante)

    let ukupno = 0;
    // ... (ostale globalne varijable)
    let adsConfiguration = { enabled: false, buttonText: "", defaultBgColor: "#f9f9f9", adsList: [] };
    let adsFooterText = "";

    // DOM Elementi
    // ... (svi DOM elementi)
    let lightboxOverlay, lightboxImage, closeLightbox;

    // ... (sve funkcije od parseTime do kraja)
    // *** FUNKCIJE ZA PROMJENU PRIKAZA (VIEW) ***
    function switchToScannerView() {
        console.log("switchToScannerView: Pokrenuto.");
        if (document.body.classList.contains('scanner-view') && !isScannerActive) {
            initializeScanner();
        }
        document.body.classList.remove('history-view', 'ads-view');
        document.body.classList.add('scanner-view');
        updateDisplay();
        requestAnimationFrame(initializeScanner);
        if (!visibilityListenerAttached) { attachVisibilityListener(); }
    }
    // ... (ostale funkcije)
    
    // *** NOVE FUNKCIJE ZA OGLASE, GALERIJU I LIGHTBOX ***
    function renderAdsPage() {
        if (!adsContentDiv) return;
        let adsHtml = '';
        if (adsConfiguration.adsList && adsConfiguration.adsList.length > 0) {
            adsConfiguration.adsList.forEach((ad, adIndex) => {
                // Postavi zadanu boju pozadine
                const bgColor = adsConfiguration.defaultBgColor || '#f9f9f9';

                // Kreiraj media slider HTML
                let mediaHtml = '';
                if (ad.media && ad.media.length > 0) {
                    mediaHtml += `<div class="media-slider-container" data-ad-index="${adIndex}">`;
                    ad.media.forEach((mediaItem, mediaIndex) => {
                        const isActive = mediaIndex === 0 ? 'active' : '';
                        if (mediaItem.type === 'image') {
                            mediaHtml += `<div class="media-slide ${isActive}"><img src="${mediaItem.src}" alt="Slika oglasa" class="ad-media-image"></div>`;
                        } else if (mediaItem.type === 'video') {
                            // Omogući fullscreen za iframe
                            mediaHtml += `<div class="media-slide ${isActive}"><iframe src="${mediaItem.src}" allow="fullscreen"></iframe></div>`;
                        }
                    });
                    // Dodaj strelice samo ako ima više od 1 medijskog elementa
                    if (ad.media.length > 1) {
                        mediaHtml += `<button class="slider-arrow prev-arrow">&lt;</button><button class="slider-arrow next-arrow">&gt;</button>`;
                    }
                    mediaHtml += `</div>`;
                }

                // Kreiraj kontakt link
                let kontaktHtml = '';
                if (ad.kontakt) {
                    const kontaktTrimmed = ad.kontakt.trim();
                    if (kontaktTrimmed.includes('@')) {
                        kontaktHtml = `<div class="ad-contact"><a href="mailto:${kontaktTrimmed}">KONTAKT: ${kontaktTrimmed}</a></div>`;
                    } else {
                        // Ukloni sve što nije broj za tel: link
                        const telLink = kontaktTrimmed.replace(/\s+/g, '');
                        kontaktHtml = `<div class="ad-contact"><a href="tel:${telLink}">KONTAKT: ${kontaktTrimmed}</a></div>`;
                    }
                }

                // Kreiraj web link
                let webHtml = '';
                if (ad.web) {
                    webHtml = `<div class="ad-web-link"><a href="${ad.web}" target="_blank">Posjeti web stranicu</a></div>`;
                }

                adsHtml += `
                    <div class="ad-card" style="background-color: ${bgColor};">
                        ${ad.nazivFirme ? `<div class="ad-title">${ad.nazivFirme}</div>` : ''}
                        ${mediaHtml}
                        ${ad.tekst ? `<div class="ad-text">${ad.tekst}</div>` : ''}
                        ${kontaktHtml}
                        ${webHtml}
                    </div>
                `;
            });
        } else {
            adsHtml = '<p style="text-align:center; color: white; padding: 2em 0;">Trenutno nema dostupnih ponuda.</p>';
        }

        if (adsFooterText && adsFooterText.trim() !== "") {
            adsHtml += `<div id="ads-footer-promo">${adsFooterText}</div>`;
        }
        adsContentDiv.innerHTML = adsHtml;
    }

    function setupInteractiveAds() {
        if (!adsContentDiv) return;

        adsContentDiv.addEventListener('click', function(event) {
            // Logika za slider
            if (event.target.classList.contains('slider-arrow')) {
                const slider = event.target.closest('.media-slider-container');
                const slides = slider.querySelectorAll('.media-slide');
                let currentIndex = Array.from(slides).findIndex(slide => slide.classList.contains('active'));
                
                slides[currentIndex].classList.remove('active');
                
                if (event.target.classList.contains('next-arrow')) {
                    currentIndex = (currentIndex + 1) % slides.length;
                } else {
                    currentIndex = (currentIndex - 1 + slides.length) % slides.length;
                }
                
                slides[currentIndex].classList.add('active');
            }

            // Logika za lightbox
            if (event.target.classList.contains('ad-media-image')) {
                openLightbox(event.target.src);
            }
        });
    }

    function openLightbox(src) {
        if (!lightboxOverlay || !lightboxImage) return;
        lightboxImage.src = src;
        lightboxOverlay.style.display = 'flex';
    }

    function closeLightbox() {
        if (!lightboxOverlay) return;
        lightboxOverlay.style.display = 'none';
        lightboxImage.src = ''; // Očisti src da se ne učitava u pozadini
    }

    function switchToAdsView() {
        console.log("switchToAdsView: Pokrenuto.");
        playSound('click-sound');
        sendLogData({ Event: 'ads_page_opened' });
        stopScanner().finally(() => {
            document.body.classList.remove('scanner-view', 'history-view');
            document.body.classList.add('ads-view');
            renderAdsPage();
            setupInteractiveAds(); // Postavi listenere za galeriju i lightbox
        });
    }

    // ... (ostatak JavaScript koda, od DOMContentLoaded nadalje)
    document.addEventListener('DOMContentLoaded', () => {
        // ... (dohvaćanje svih DOM elemenata, uključujući nove za lightbox)
        lightboxOverlay = document.getElementById('lightbox-overlay');
        lightboxImage = document.getElementById('lightbox-image');
        closeLightbox = document.getElementById('close-lightbox');

        // ... (svi ostali listeneri)
        
        // Listeneri za zatvaranje lightboxa
        if (closeLightbox) closeLightbox.addEventListener('click', closeLightbox);
        if (lightboxOverlay) lightboxOverlay.addEventListener('click', function(event) {
            if (event.target === lightboxOverlay) { // Zatvori samo ako se klikne na pozadinu
                closeLightbox();
            }
        });

        // ... (ostatak DOMContentLoaded funkcije)
    });

</script>

  <!-- Statcounter kod -->
  <script type="text/javascript"> var sc_project=12702047; var sc_invisible=1; var sc_security="e75d2592"; var scJsHost = "https://"; (function() { var sc = document.createElement('script'); sc.type = 'text/javascript'; sc.async = true; sc.src = scJsHost + "statcounter.com/counter/counter.js"; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(sc, s); })(); </script>
  <noscript><div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img class="statcounter" src="https://c.statcounter.com/12702047/0/e75d2592/1/" alt="Web Analytics" referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>
  <!-- Kraj Statcounter koda -->

</body>
</html>
